<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/277915; Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="304"/>

<div>
<span><div><h1 style="padding: 0px; margin: 20px 0px 10px; font-weight: 600; font-size: 24px; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">责任链（ChainOfResponsibility）</h1><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">对于设计模式的学习，一定要动手，而且要多次练习，然后慢慢消化和理解，才能明白其精髓。但是，设计模式只是在特殊情景下的特殊解决方案，不要滥用，不要为了使用设计模式而硬生生得去使用。设计模式的使用应该自然、优雅！</p><h3 style="padding: 0px; margin: 15px 0px 10px; font-weight: 600; font-size: 16px; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">问题</h3><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> class TestMain {
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">static</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">void</span> main(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">String</span>[] args) {
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">String</span> <span style="padding: 0px; margin: 0px;">str</span> = <span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;你好:)，这句话中有敏感词汇，需要处理。&lt;script&gt;，敏感！&quot;</span>;
    MsgProcessor pro = <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> MsgProcessor();
    pro.setMsg(<span style="padding: 0px; margin: 0px;">str</span>);
    <span style="padding: 0px; margin: 0px;">str</span> = pro.processor();---
    System.out.<span style="padding: 0px; margin: 0px;">println</span>(<span style="padding: 0px; margin: 0px;">str</span>);
}
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">另一个类：</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">class</span> MsgProcessor {
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">private</span> <span style="padding: 0px; margin: 0px;">String</span> msg;
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;">String</span> getMsg() {
    return msg;
}
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> void setMsg(<span style="padding: 0px; margin: 0px;">String</span> msg) {
    this.msg = msg;
}

<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;">String</span> processor(){
    <span style="padding: 0px; margin: 0px;">String</span> content = <span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;&quot;</span>;
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">if</span>(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">null</span> != msg &amp;&amp; !(<span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;&quot;</span>).equals(msg.<span style="padding: 0px; margin: 0px;">trim</span>())){
        content = msg.<span style="padding: 0px; margin: 0px;">replace</span>(<span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;&lt;&quot;</span>, <span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;{&quot;</span>)
        .<span style="padding: 0px; margin: 0px;">replace</span>(<span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;&gt;&quot;</span>, <span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;}&quot;</span>);

        content = content.<span style="padding: 0px; margin: 0px;">replace</span>(<span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;敏感&quot;</span>, <span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;&quot;</span>);
        content = content.<span style="padding: 0px; margin: 0px;">replace</span>(<span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;:)&quot;</span>, <span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;^V^&quot;</span>);
    }
    return content;
}  
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">上面的代码完成了对一个字符串的简单过滤，但是很明显这样的代码很不好。扩展性不好，写得也不够好。这样以后需要添加别的过滤功能不是很方便，总是要修改这个类，一点都不灵活，想把对字符串的过滤行为抽象出来，因为这部分是变化的，自然而然想到使用接口。</p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="http://my.oschina.net/action/blog/img_proxy?url=http%3A%2F%2Fww2.sinaimg.cn%2Fmw690%2F5ae9e02djw1eha0fzhsusj20hm080763.jpg" style="padding: 0px; margin: 0px; color: rgb(255, 131, 115); outline: 0px; font-size: 12px;" target="_blank"><img alt="使用接口来剥离行为" src="http://my.oschina.net/action/blog/img_proxy?url=http%3A%2F%2Fww2.sinaimg.cn%2Fmw690%2F5ae9e02djw1eha0fzhsusj20hm080763.jpg" style="padding: 0px; margin: 10px 0px; border: 1px solid rgb(221, 221, 221); max-width: 640px; background-color: rgb(244, 247, 249); cursor: pointer; height: auto;"></img></a></p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">代码修改为：</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;">String</span> processor(){
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">if</span>(<span style="padding: 0px; margin: 0px;">null</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">!=</span> msg <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">&amp;&amp;</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">!</span>(<span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;&quot;</span>)<span style="padding: 0px; margin: 0px;">.</span><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">equals</span>(msg<span style="padding: 0px; margin: 0px;">.</span>trim())){
        msg <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">=</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> HTMLFilter()<span style="padding: 0px; margin: 0px;">.</span>doFilter(msg);
        msg <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">=</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> SmileFilter()<span style="padding: 0px; margin: 0px;">.</span>doFilter(msg);
        msg <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">=</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> SensitivityFilter()<span style="padding: 0px; margin: 0px;">.</span>doFilter(msg);
    }
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> msg;
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">这样还是不够灵活，直接在 MsgProcessor 类中添加一个数组来保存过滤器，然后在 processor** 方法中进行多次调用：</p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">修改为：</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">String</span> processor(){
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">if</span>(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">null</span> != msg &amp;&amp; !(<span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;&quot;</span>).equals(msg.<span style="padding: 0px; margin: 0px;">trim</span>())){
        <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">for</span>(Filter f : filters){
            msg = f.doFilter(msg);
        }
    }
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> msg;
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">这样调整后，所有的过滤器都起作用了，添加起来更加灵活一些，并且过滤器的执行顺序也是可控的。</p><blockquote style="padding: 3px 25px; margin: 20px 10px; position: relative; background-color: rgb(244, 253, 253); text-align: left; color: rgb(51, 51, 51); font-size: 13px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(164, 218, 240); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 12.5px; white-space: normal; word-wrap: break-word; word-break: break-all;">当多个过滤器组合在一起，就形成了过滤器链，到这里，责任链有点雏形了。</p></blockquote><h3 style="padding: 0px; margin: 15px 0px 10px; font-weight: 600; font-size: 16px; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">新的问题</h3><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">如果本来已经存在一个过滤器链条了，我想把一些新的过滤器链加进去，并且加入的顺序可以随意控制（随意组合任意的过滤器链条），该怎么办呢？</p><blockquote style="padding: 3px 25px; margin: 20px 10px; position: relative; background-color: rgb(244, 253, 253); text-align: left; color: rgb(51, 51, 51); font-size: 13px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(164, 218, 240); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 12.5px; white-space: normal; word-wrap: break-word; word-break: break-all;">定义一个过滤器链类，这这个类中定义添加过滤器的方法，以及运行整个链条上的所有过滤器的方法，并且返回结果。</p></blockquote><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">代码修改为：</p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">MsgProcessor.java :</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">class</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">MsgProcessor</span> </span>{
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">private</span> String msg;

<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">private</span> FilterChain fc;

<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;">FilterChain <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">getFc</span><span style="padding: 0px; margin: 0px;">()</span> </span>{
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> fc;
}
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">void</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">setFc</span><span style="padding: 0px; margin: 0px;">(FilterChain fc)</span> </span>{
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">this</span>.fc = fc;
}
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;">String <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">getMsg</span><span style="padding: 0px; margin: 0px;">()</span> </span>{
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> msg;
}
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">void</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">setMsg</span><span style="padding: 0px; margin: 0px;">(String msg)</span> </span>{
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">this</span>.msg = msg;
}

<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px;">String <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">processor</span><span style="padding: 0px; margin: 0px;">()</span></span>{
    <span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> fc.<span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">doFilter</span><span style="padding: 0px; margin: 0px;">(msg)</span></span>;
}
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">FilterChain.java:</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> class FilterChain {
List&lt;Filter&gt; filters = <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> ArrayList&lt;Filter&gt;();

<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> FilterChain addFilter(Filter <span style="padding: 0px; margin: 0px;">filter</span>){
    filters.<span style="padding: 0px; margin: 0px;">add</span>(<span style="padding: 0px; margin: 0px;">filter</span>);
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">this</span>;
}

<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">String</span> doFilter(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">String</span> <span style="padding: 0px; margin: 0px;">str</span>){
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">if</span>(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">null</span> != <span style="padding: 0px; margin: 0px;">str</span> &amp;&amp; !(<span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;&quot;</span>).equals(<span style="padding: 0px; margin: 0px;">str</span>.<span style="padding: 0px; margin: 0px;">trim</span>())){
        <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">for</span>(Filter f : filters){
            <span style="padding: 0px; margin: 0px;">str</span> = f.doFilter(<span style="padding: 0px; margin: 0px;">str</span>);
        }
    }
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> <span style="padding: 0px; margin: 0px;">str</span>;
}
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">TestMain.java</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> class TestMain {
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">static</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">void</span> main(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">String</span>[] args) {
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">String</span> <span style="padding: 0px; margin: 0px;">str</span> = <span style="padding: 0px; margin: 0px; font-weight: 700; color: green;">&quot;你好:)，这句话中有敏感词汇，需要处理。&lt;script&gt;，敏感！&quot;</span>;
    MsgProcessor mp = <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> MsgProcessor();
    mp.setMsg(<span style="padding: 0px; margin: 0px;">str</span>);
    FilterChain fc = <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> FilterChain();
    fc.addFilter(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> HTMLFilter())
    .addFilter(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> SmileFilter())
    .addFilter(<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> SensitivityFilter());
    mp.setFc(fc);
    <span style="padding: 0px; margin: 0px;">str</span> = mp.processor();
    System.out.<span style="padding: 0px; margin: 0px;">println</span>(<span style="padding: 0px; margin: 0px;">str</span>);
}
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">写到这里，还是没有解决我们的问题，怎样灵活合并过滤器链呢？ 很简单，我们可以将过滤器链这个类，当作一个很大的过滤器来处理，这样就可以了。让<strong style="padding: 0px; margin: 0px;"> FilterChain </strong>也实现Filter接口，这样就解决了这个问题！完成这一步，就已经有了责任链模式的味道了！</p><h3 style="padding: 0px; margin: 15px 0px 10px; font-weight: 600; font-size: 16px; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">思考实际开发中的问题</h3><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">在实际开发中，我们见过的过滤器都能进行双向的处理，也就是说，能处理request和response，而且是先挨着处理request，然后再反向处理response，这又是怎么实现的呢？ <br style="padding: 0px; margin: 0px;"/><a href="http://my.oschina.net/action/blog/img_proxy?url=http%3A%2F%2Fww4.sinaimg.cn%2Fmw690%2F5ae9e02djw1eha1qj5youj20md0bg0tb.jpg" style="padding: 0px; margin: 0px; color: rgb(255, 131, 115); outline: 0px; font-size: 12px;" target="_blank"><img alt="过滤器链图" src="http://my.oschina.net/action/blog/img_proxy?url=http%3A%2F%2Fww4.sinaimg.cn%2Fmw690%2F5ae9e02djw1eha1qj5youj20md0bg0tb.jpg" style="padding: 0px; margin: 10px 0px; border: 1px solid rgb(221, 221, 221); max-width: 640px; background-color: rgb(244, 247, 249); cursor: pointer; height: auto;"></img></a></p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">定义一个Request和Response，在实际的web容器中，容器会帮助我们生成这两个对象，而且在其中封装了很多的东西，在这里，只是模拟，只需简单定义就可以了。</p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Request.java</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">class</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">Request</span> {
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">private</span> String requestStr;
<span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> String <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">getRequestStr</span><span style="padding: 0px; margin: 0px;">()</span> </span>{
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> requestStr;
}
<span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">void</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">setRequestStr</span><span style="padding: 0px; margin: 0px;">(String requestStr)</span> </span>{
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">this</span>.requestStr = requestStr;
}
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Response.java</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">class</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">Response</span> {
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">private</span> String responseStr;
<span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> String <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">getResponseStr</span><span style="padding: 0px; margin: 0px;">()</span> </span>{
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">return</span> responseStr;
}
<span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">void</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">setResponseStr</span><span style="padding: 0px; margin: 0px;">(String responseStr)</span> </span>{
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">this</span>.responseStr = responseStr;
}
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">定义好这两个类之后，修改之前的程序：</p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Filter.java</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">interface</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">Filter</span> {
    <span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">abstract</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">void</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">doFilter</span><span style="padding: 0px; margin: 0px;">(Request request, Response response)</span></span>;
}
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">别的代码跟着这个接口一起改就可以了，但是你会发现，还是不能实现我们想要的效果，这个时候需要一些编程的手法，我们继续修改<strong style="padding: 0px; margin: 0px;">Filter</strong>接口：</p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Filter.java</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">interface</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">Filter</span> {
    <span style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">abstract</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">void</span> <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 0);">doFilter</span><span style="padding: 0px; margin: 0px;">(Request request, Response response, FilterChain filterChain)</span></span>;
}  
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">为什么要这样修改，因为只有这样才能把链条握在每一个过滤器手中，有了链条，就可以控制链条了：</p><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">FilterChain.java</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">class</span> FilterChain implements <span style="padding: 0px; margin: 0px;">Filter</span> {
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">private</span> List&lt;<span style="padding: 0px; margin: 0px;">Filter</span>&gt; filters = <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">new</span> ArrayList&lt;<span style="padding: 0px; margin: 0px;">Filter</span>&gt;();
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">private</span> <span style="padding: 0px; margin: 0px;">int</span> index = <span style="padding: 0px; margin: 0px; font-weight: 400; color: rgb(0, 0, 255);">0</span>;
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> FilterChain addFilter(<span style="padding: 0px; margin: 0px;">Filter</span> <span style="padding: 0px; margin: 0px;">filter</span>){
    this.filters.add(<span style="padding: 0px; margin: 0px;">filter</span>);
    return this;
}
@Override
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> void doFilter(<span style="padding: 0px; margin: 0px;">Request</span> <span style="padding: 0px; margin: 0px;">request</span>, <span style="padding: 0px; margin: 0px;">Response</span> <span style="padding: 0px; margin: 0px;">response</span>,
        FilterChain filterChain) {
    <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">if</span>(index &gt;= filters.size()) return;
    <span style="padding: 0px; margin: 0px;">Filter</span> f = filters.<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">get</span>(index);
    index++;
    f.doFilter(<span style="padding: 0px; margin: 0px;">request</span>, <span style="padding: 0px; margin: 0px;">response</span>, filterChain);
}
}  
</code></pre><p style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">HTMLFilter.java</p><pre style="padding: 5px; margin: 0px; font-size: 9pt; font-family: &apos;Courier New&apos;, Arial; border: 1px solid rgb(221, 221, 221); background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><code style="padding: 8px 5px; margin: 0px 2px; display: block; overflow-x: auto; background-color: rgb(255, 255, 255); color: red; font-family: Consolas, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, &apos;monospace !important&apos;; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; background-position: initial initial; background-repeat: initial initial;"><span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> <span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">class</span> HTMLFilter implements <span style="padding: 0px; margin: 0px;">Filter</span> {
@Override
<span style="padding: 0px; margin: 0px; font-weight: 700; color: navy;">public</span> void doFilter(<span style="padding: 0px; margin: 0px;">Request</span> <span style="padding: 0px; margin: 0px;">request</span>, <span style="padding: 0px; margin: 0px;">Response</span> <span style="padding: 0px; margin: 0px;">response</span>,
        FilterChain filterChain) {
    <span style="padding: 0px; margin: 0px;">String</span> str = <span style="padding: 0px; margin: 0px;">request</span>.getRequestStr();
    System.out.println(str);
    filterChain.doFilter(<span style="padding: 0px; margin: 0px;">request</span>, <span style="padding: 0px; margin: 0px;">response</span>, filterChain);
    <span style="padding: 0px; margin: 0px;">String</span> resStr = <span style="padding: 0px; margin: 0px;">response</span>.getResponseStr();
    System.out.println(resStr);
}
}  
</code></pre><div style="padding: 0px; margin: 8px 0px; letter-spacing: 0.5px; font-size: 13px; white-space: normal; word-wrap: break-word; word-break: break-all; color: rgb(51, 51, 51); font-family: &apos;Microsoft YaHei&apos;, Verdana, sans-serif, 宋体; font-style: normal; font-variant: normal; font-weight: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">现在来看，每个过滤器都持有过滤器链，在处理完request后，调用下一个过滤器，由于方法是栈结构，这样就会形成一个过滤器栈，拥有栈的数据结构特点。这也是为什么Struts在配置多个拦截器的时候，成为拦截器栈的原因。 
<div>由于栈的数据特点，就能达到我们想要的特点，按照过滤器的次序，依次处理完request，然后再反向依次处理response。这就是责任链模式在实际开发中的使用。</div></div></div></span>
</div></body></html> 