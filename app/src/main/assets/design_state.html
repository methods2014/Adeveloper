<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/277915; Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="310"/>

<div>
<span><div><div style="margin: 0px; padding: 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>状态模式——State (更好的实现状态机)</div><div><span style="font-size: 14px;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-size: small;">1. 概述</span></span></span></div></div><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    The intent of the STATE pattern is to distribute state-specific logic across classes that represent an object’s state.</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    <span style="color: red;">STATE</span> 设计模式的目的 是：将特定状态相关的逻辑分散到一些类的状态类中。</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;"> </span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">2. 实例</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    旋转门： Consider the model of the state of a carousel door(revolving door). A carousel is a large, smart rack that accepts material through a doorway and stores the material according to a bar code ID on it. The door operates with a single button. See the state diagram below for some detail.</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;"> </span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    旋转门的状态图：（状态图细节见 4. ）</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/><img src="http://dl.iteye.com/upload/attachment/612921/0f31f3ab-c496-31eb-bc45-6442cf3be84d.png" style="border: 0px;"></img></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;"> </span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">3. 状态模型的两种实现方法</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    3.1 方法一： switch</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">  </span><br/><img src="http://dl.iteye.com/upload/attachment/612924/fde21594-aecc-3cce-88e7-d8e393bcd570.png" style="border: 0px;"></img></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Observable是java.util中的类^^居然以前都不晓得哦，该打！</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Door的具体实现如下：</p><div style="font-family: Monaco, &apos;DejaVu Sans Mono&apos;, &apos;Bitstream Vera Sans Mono&apos;, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="padding: 3px; text-align: left; margin: 0px; color: black; font-weight: bold;">Java代码  <a style="color: rgb(0, 102, 0); text-decoration: underline;" title="收藏这段代码"><img src="design_state_files/Image.png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div><ol start="1" style="font-size: 1em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style: decimal; background-color: rgb(255, 255, 255); color: rgb(43, 145, 175);"><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">import</span><span style="color: black;"> java.util.Observable;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">/**</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;"> * This class provides an initial model of a carousel door</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;"> * that manages its state without moving state-specific</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;"> * logic out to state classes.</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;"> */</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">class</span><span style="color: black;"> Door </span><span style="color: rgb(127, 0, 85); font-weight: bold;">extends</span><span style="color: black;"> Observable {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">int</span><span style="color: black;"> CLOSED = -</span><span style="color: rgb(192, 0, 0);">1</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">int</span><span style="color: black;"> OPENING = -</span><span style="color: rgb(192, 0, 0);">2</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">int</span><span style="color: black;"> OPEN = -</span><span style="color: rgb(192, 0, 0);">3</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">int</span><span style="color: black;"> CLOSING = -</span><span style="color: rgb(192, 0, 0);">4</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">int</span><span style="color: black;"> STAYOPEN = -</span><span style="color: rgb(192, 0, 0);">5</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">private</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">int</span><span style="color: black;"> state = CLOSED;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">/**</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     * The carousel user has touched the carousel button. This &quot;one touch&quot;</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     * button elicits different behaviors, depending on the state of the door.</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     */</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> touch() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">switch</span><span style="color: black;"> (state)  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        {  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> OPENING:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> STAYOPEN:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                setState(CLOSING);  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">break</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> CLOSING:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> CLOSED:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                setState(OPENING);  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">break</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> OPEN:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                setState(STAYOPEN);  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">break</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">default</span><span style="color: black;">:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">throw</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">new</span><span style="color: black;"> Error(</span><span style="color: blue;">&quot;can't happen&quot;</span><span style="color: black;">);  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">/** </span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     * This is a notification from the mechanical carousel that </span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     * the door finished opening or shutting.</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     */</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> complete() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span><span style="color: black;"> (state == OPENING)  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            setState(OPEN);  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">else</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">if</span><span style="color: black;"> (state == CLOSING)  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            setState(CLOSED);  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">/**</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     * This is a notification from the mechanical carousel that the</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     * door got tired of being open.</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     */</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> timeout() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            setState(CLOSING);  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">       </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">/**</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     * @return a textual description of the door's state</span> </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">     */</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> String status()  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    {  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">switch</span><span style="color: black;"> (state)  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        {  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> OPENING:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span><span style="color: black;"> </span><span style="color: blue;">&quot;Opening&quot;</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> OPEN:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span><span style="color: black;"> </span><span style="color: blue;">&quot;Open&quot;</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> CLOSING:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span><span style="color: black;"> </span><span style="color: blue;">&quot;Closing&quot;</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">case</span><span style="color: black;"> STAYOPEN:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span><span style="color: black;"> </span><span style="color: blue;">&quot;StayOpen&quot;</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">            <span style="color: rgb(127, 0, 85); font-weight: bold;">default</span><span style="color: black;">:  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">                <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span><span style="color: black;"> </span><span style="color: blue;">&quot;Closed&quot;</span><span style="color: black;">;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">private</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> setState(</span><span style="color: rgb(127, 0, 85); font-weight: bold;">int</span><span style="color: black;"> state)  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    {  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">this</span><span style="color: black;">.state = state;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        setChanged();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        notifyObservers();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">}  </span></li></ol></div><span style="color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">但是采用这种实现，有一个缺陷：state变量在Door类的实现中浑身扩散，就像癌症一般！</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    3.2 方法二： State Pattern</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 10.5pt;">    A. </span>基本的 <span style="font-size: 10.5pt;">State Pattern</span> 实现</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/><img src="http://dl.iteye.com/upload/attachment/613031/80e517f4-88e3-30f1-9069-d409a1e0f9c2.png" style="border: 0px;"></img></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    以上设计方式要求每个状态子类实例内部“ hold 住”一个 Door2 实例的引用，这样才能完成 Door2 实例和它的各个状态实例时间的互相通信。这种设计要求一个状态实例对应一个 Door2 实例，这样一来，一个状态实例就只能为一个 Door2 实例服务╮ ( ╯▽╰ ) ╭</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 10.5pt;">    </span>客户端这样调用：</p><div style="font-family: Monaco, &apos;DejaVu Sans Mono&apos;, &apos;Bitstream Vera Sans Mono&apos;, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="padding: 3px; text-align: left; margin: 0px; color: black; font-weight: bold;">Java代码  <a style="color: rgb(0, 102, 0); text-decoration: underline;" title="收藏这段代码"><img src="design_state_files/Image [1].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div><ol start="1" style="font-size: 1em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style: decimal; background-color: rgb(255, 255, 255); color: rgb(43, 145, 175);"><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">static</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> main(String[] args){  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        Door2 door=<span style="color: rgb(127, 0, 85); font-weight: bold;">new</span><span style="color: black;"> Door2();  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">          </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">//1. 初始状态</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        System.out.println(door.status());  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">          </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">//2. 转移到Opening状态</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        door.touch();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        System.out.println(door.status());  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">          </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">//3. 转移到Open状态</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        door.complete();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        System.out.println(door.status());  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">          </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">//4. 转移到Closing状态</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        door.timeout();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        System.out.println(door.status());  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">          </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">//5. 回到Closed状态</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        door.complete();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        System.out.println(door.status());  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li></ol></div><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">下面给出Door2类、DoorState抽象类、DoorStayOpen类的实现：</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Door2:</p><div style="font-family: Monaco, &apos;DejaVu Sans Mono&apos;, &apos;Bitstream Vera Sans Mono&apos;, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="padding: 3px; text-align: left; margin: 0px; color: black; font-weight: bold;">Java代码  <a style="color: rgb(0, 102, 0); text-decoration: underline;" title="收藏这段代码"><img src="design_state_files/Image [2].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div><ol start="1" style="font-size: 1em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style: decimal; background-color: rgb(255, 255, 255); color: rgb(43, 145, 175);"><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">class</span><span style="color: black;"> Door2 </span><span style="color: rgb(127, 0, 85); font-weight: bold;">extends</span><span style="color: black;"> Observable {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> DoorState CLOSED = </span><span style="color: rgb(127, 0, 85); font-weight: bold;">new</span><span style="color: black;"> DoorClosed(</span><span style="color: rgb(127, 0, 85); font-weight: bold;">this</span><span style="color: black;">);  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> DoorState CLOSING = </span><span style="color: rgb(127, 0, 85); font-weight: bold;">new</span><span style="color: black;"> DoorClosing(</span><span style="color: rgb(127, 0, 85); font-weight: bold;">this</span><span style="color: black;">);  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> DoorState OPEN = </span><span style="color: rgb(127, 0, 85); font-weight: bold;">new</span><span style="color: black;"> DoorOpen(</span><span style="color: rgb(127, 0, 85); font-weight: bold;">this</span><span style="color: black;">);  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> DoorState OPENING = </span><span style="color: rgb(127, 0, 85); font-weight: bold;">new</span><span style="color: black;"> DoorOpening(</span><span style="color: rgb(127, 0, 85); font-weight: bold;">this</span><span style="color: black;">);  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span><span style="color: black;"> DoorState STAYOPEN = </span><span style="color: rgb(127, 0, 85); font-weight: bold;">new</span><span style="color: black;"> DoorStayOpen(</span><span style="color: rgb(127, 0, 85); font-weight: bold;">this</span><span style="color: black;">);  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">private</span><span style="color: black;"> DoorState state = CLOSED;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> touch() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        state.touch();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> complete() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        state.complete();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> timeout() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        state.timeout();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> String status() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span><span style="color: black;"> state.status();  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">protected</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> setState(DoorState state) {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">this</span><span style="color: black;">.state = state;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        setChanged();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        notifyObservers();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li></ol></div><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">DoorState抽象类：</p><div style="font-family: Monaco, &apos;DejaVu Sans Mono&apos;, &apos;Bitstream Vera Sans Mono&apos;, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="padding: 3px; text-align: left; margin: 0px; color: black; font-weight: bold;">Java代码  <a style="color: rgb(0, 102, 0); text-decoration: underline;" title="收藏这段代码"><img src="design_state_files/Image [3].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div><ol start="1" style="font-size: 1em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style: decimal; background-color: rgb(255, 255, 255); color: rgb(43, 145, 175);"><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">abstract</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">class</span><span style="color: black;"> DoorState {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">protected</span><span style="color: black;"> Door2 door;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">abstract</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> touch();  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> complete() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> timeout() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> String status() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        String s = getClass().getName();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span><span style="color: black;"> s.substring(s.lastIndexOf(</span><span style="color: blue;">'.'</span><span style="color: black;">) + </span><span style="color: rgb(192, 0, 0);">1</span><span style="color: black;">);  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> DoorState(Door2 door) {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">this</span><span style="color: black;">.door = door;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">}  </span></li></ol></div><span style="color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">DoorStayOpen类：</p><div style="font-family: Monaco, &apos;DejaVu Sans Mono&apos;, &apos;Bitstream Vera Sans Mono&apos;, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="padding: 3px; text-align: left; margin: 0px; color: black; font-weight: bold;">Java代码  <a style="color: rgb(0, 102, 0); text-decoration: underline;" title="收藏这段代码"><img src="design_state_files/Image [4].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div><ol start="1" style="font-size: 1em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style: decimal; background-color: rgb(255, 255, 255); color: rgb(43, 145, 175);"><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">class</span><span style="color: black;"> DoorStayOpen </span><span style="color: rgb(127, 0, 85); font-weight: bold;">extends</span><span style="color: black;"> DoorState {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> DoorStayOpen(Door2 door) {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">super</span><span style="color: black;">(door);  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> touch() {  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">        door.setState(door.CLOSING);  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">}  </span></li></ol></div><span style="color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    B. State Pattern 实现 2 ——让状态实例（ DoorState 的子类实例）为多个 Door2 实例服务</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    子状态 DoorOpen 实现转移时只负责返回下目标状态是什么，将状态转移的 action 留给 Door2 实例自己来做；而不是像“ A. 基本的 State Pattern 实现”那样在 DoorOpen 内部保存一个 Door2 实例的引用 door ，亲自调用door.setState(door.STAYOPEN); 来实现状态转移</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    改进后的关键代码：</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">   </p><div style="font-family: Monaco, &apos;DejaVu Sans Mono&apos;, &apos;Bitstream Vera Sans Mono&apos;, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="padding: 3px; text-align: left; margin: 0px; color: black; font-weight: bold;">Java代码  <a style="color: rgb(0, 102, 0); text-decoration: underline;" title="收藏这段代码"><img src="design_state_files/Image [5].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div><ol start="1" style="font-size: 1em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style: decimal; background-color: rgb(255, 255, 255); color: rgb(43, 145, 175);"><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">class</span><span style="color: black;"> DoorOpen </span><span style="color: rgb(127, 0, 85); font-weight: bold;">extends</span><span style="color: black;"> DoorState{  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">       <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> DoorState touch(){  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">           <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span><span style="color: black;"> DoorState.STAYOPEN;  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">           <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">// 以前是 door.setState(door.STAYOPEN);</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">       }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">       ...  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">}  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">   </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">class</span><span style="color: black;"> Door2 </span><span style="color: rgb(127, 0, 85); font-weight: bold;">extends</span><span style="color: black;"> Observable{  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">       <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span><span style="color: black;"> </span><span style="color: rgb(127, 0, 85); font-weight: bold;">void</span><span style="color: black;"> touch(){  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">           state=state.touch();  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">           <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">// 以前是 state.touch();</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">           <span style="color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;">// 即将转移状态的工作留给状态实例来做，事不关己高高挂起</span><span style="color: black;">  </span></span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">       }  </span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(209, 215, 220); background-color: rgb(250, 250, 250);"><span style="color: black;">}   </span></li></ol></div><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><span style="color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    C. State Pattern 实现 3 ——让状态实例（ DoorState 的子类实例）为多个 Door2 实例服务</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    另一种实现这种效果的方法是：将 Door2 实例作为参数传递给 DoorState 的状态转移方法，而非建立Composite 的关联关系（将 DoorState 的子类对象作为 Door2 的属性）。</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    也即，用“ Dependency 依赖”（弱依赖，如调用）代替了“ Association 关联”（强依赖，如作为属性进行组合）。</p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">4. 状态图细节</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    何谓 State 状态 : Generally speaking, the state of an object depends on the collective value of the object ’ s instance variables. In some cases, most of an object ’ s attributes are fairly static once set, and one attribute is dynamic and plays a prominent role in the class ’ s logic. This attribute may represent the state of the entire object and may even be named state.</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/><img src="http://dl.iteye.com/upload/attachment/612926/017dd22f-d41c-3ef6-8b16-f4be3778f1dd.png" style="border: 0px;"></img><br/><img src="http://dl.iteye.com/upload/attachment/612928/a0d758c2-1008-3b3a-9201-fae2c8f981b3.png" style="border: 0px; float: right;"></img></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;"> </span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    4.1 State</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    You can subdivide a state icon into areas that show the <span style="color: red;">state</span> <span style="color: red;">’</span> s name and <span style="color: red;">activities</span>活动 .</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    3 frequently used categories of activities are <span style="color: red;">entry</span> (what happens when the system enters the state), <span style="color: red;">exit </span>(what happens when the system leaves the state), and <span style="color: red;">do </span>(what happens while the system is in the state).</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/><img src="http://dl.iteye.com/upload/attachment/612930/e2f30368-d2d8-35b4-b380-f346f3ed3fe9.png" style="border: 0px;"></img></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;"> </span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    4.2 <span style="color: red;">Transition</span> s (Details: Event[Guard Condition]/Action)</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    You can also add some details to the transition lines. You can indicate an event that causes a transition to occur (a<span style="color: red;">trigger event</span> ) and the computation (the <span style="color: red;">action</span> ) that executes and makes the state change happen.</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">    A <span style="color: red;">guard condition</span> : when it’s met, the transition takes place. 通常将超时作为监护条件，∵可以认为此时没有任何event.</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/><img src="http://dl.iteye.com/upload/attachment/612934/8bd0d859-4393-3f23-9e03-50cce23fe174.png" style="border: 0px;"></img></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">•源状态 Source State ：即受转换影响的状态</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">•目标状态 Target State ：当转换完成后，对象的状态</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">•触发事件 (Trigger) Event ：用来为转换定义一个事件，包括调用、改变、信号、时间四类事件</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">•监护条件 (Guard Condition) ：布尔表达式，决定是否激活转换、</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">•动作 (Action) ：转换激活时的操作</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;"> </span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: small;">几个实例：</span></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/><img src="http://dl.iteye.com/upload/attachment/612936/35324baa-490c-3151-a924-18e61792e5e9.png" style="border: 0px;"></img><br/>
 <br/><img src="http://dl.iteye.com/upload/attachment/612938/e65b09d5-2368-34cc-b18d-2a6e1e920952.png" style="border: 0px;"></img></p><p style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 14px;"><div><br/></div><img src="http://dl.iteye.com/upload/attachment/616189/d6e8371c-2e43-359f-a1d5-35499898acd3.png" style="border: 0px;"></img></div></div></span>
</div></body></html> 